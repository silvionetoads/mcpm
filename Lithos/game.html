<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lithos - Tela de Jogo</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        const playerSize = 30;
        const characterSize = 30;
        let characters = [];
        let player = { x: 300, y: 300, image: null };
        let master = { x: 0, y: 0, found: false };
        let timerInterval;

        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const playerName = localStorage.getItem('playerName');
            const playerImageSrc = localStorage.getItem('playerGender') === 'male' ? 'path/to/male_character.png' : 'path/to/female_character.png';

            const images = {
                'Enoque': new Image(),
                'Adão': new Image(),
                'Caim': new Image(),
                'Mestre': new Image()
            };
            images['Enoque'].src = 'path/to/enoch.png';
            images['Adão'].src = 'path/to/adam.png';
            images['Caim'].src = 'path/to/cain.png';
            images['Mestre'].src = 'path/to/master.png';

            function initGame() {
                characters.length = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                player.x = 300;
                player.y = 300;

                const playerImg = new Image();
                playerImg.src = playerImageSrc;
                playerImg.onload = () => ctx.drawImage(playerImg, player.x, player.y, playerSize, playerSize);

                master.x = getRandomPosition();
                master.y = getRandomPosition();

                for (let i = 0; i < 3; i++) {
                    let character;
                    do {
                        character = {
                            x: getRandomPosition(),
                            y: getRandomPosition(),
                            name: ['Enoque', 'Adão', 'Caim'][i]
                        };
                    } while (characters.some(c => Math.abs(c.x - character.x) < characterSize && Math.abs(c.y - character.y) < characterSize));
                    characters.push(character);
                }
                characters.push({ x: master.x, y: master.y, name: 'Mestre' });

                characters.forEach(c => {
                    ctx.drawImage(images[c.name], c.x, c.y, characterSize, characterSize);
                });

                ctx.drawImage(playerImg, player.x, player.y, playerSize, playerSize);

                document.addEventListener('keydown', movePlayer);
                startTimer(300); // 5 minutos = 300 segundos
            }

            function getRandomPosition() {
                return Math.floor(Math.random() * (canvas.width - characterSize));
            }

            function movePlayer(event) {
                switch (event.key) {
                    case 'ArrowUp':
                        player.y = Math.max(0, player.y - 5);
                        break;
                    case 'ArrowDown':
                        player.y = Math.min(canvas.height - playerSize, player.y + 5);
                        break;
                    case 'ArrowLeft':
                        player.x = Math.max(0, player.x - 5);
                        break;
                    case 'ArrowRight':
                        player.x = Math.min(canvas.width - playerSize, player.x + 5);
                        break;
                }
                drawGame();
            }

            function drawGame() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                characters.forEach(c => {
                    ctx.drawImage(images[c.name], c.x, c.y, characterSize, characterSize);
                });

                const playerImg = new Image();
                playerImg.src = playerImageSrc;
                playerImg.onload = () => ctx.drawImage(playerImg, player.x, player.y, playerSize, playerSize);

                checkCollision();
            }

            function checkCollision() {
                for (const c of characters) {
                    if (c.name === 'Mestre') continue;
                    if (player.x < c.x + characterSize &&
                        player.x + playerSize > c.x &&
                        player.y < c.y + characterSize &&
                        player.y + playerSize > c.y) {
                        showDialog(`Você encontrou ${c.name}. Errou! Continue procurando.`, 'OK');
                        return;
                    }
                }
                if (player.x < master.x + characterSize &&
                    player.x + playerSize > master.x &&
                    player.y < master.y + characterSize &&
                    player.y + playerSize > master.y) {
                    showDialog(getRandomMessage(), 'Sim', 'Não');
                }
            }

            function showDialog(message, yesText, noText) {
                document.getElementById('dialogMessage').textContent = message;
                const dialogButton = document.getElementById('dialogButton');
                dialogButton.textContent = yesText || 'OK';
                dialogButton.onclick = () => {
                    if (yesText) {
                        dialog.classList.add('hidden');
                        window.location.href = 'end.html'; // ou outra página, se houver
                    } else {
                        dialog.classList.add('hidden');
                        window.location.href = 'index.html';
                    }
                };
                document.getElementById('dialog').classList.remove('hidden');
            }

            function getRandomMessage() {
                const messages = [
                    'Parabéns! Você encontrou o Mestre!',
                    'Ótimo trabalho! Pronto para o próximo estágio?',
                    'Você fez um ótimo trabalho! Continue assim!'
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            }

            function startTimer(seconds) {
                let remainingTime = seconds;
                timerInterval = setInterval(() => {
                    const minutes = Math.floor(remainingTime / 60);
                    const secs = remainingTime % 60;
                    document.getElementById('time').textContent = `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                    remainingTime--;
                    if (remainingTime < 0) {
                        clearInterval(timerInterval);
                        alert('Tempo esgotado! O jogo acabou.');
                        // Optionally, handle what happens when time is up
                    }
                }, 1000);
            }

            initGame();
        });
    </script>
</head>
<body>
    <div id="gameScreen" class="screen">
        <div class="game-info">
            <p id="welcomeMessage">Bom jogo! Use as setas do teclado para se mover e encontrar o Mestre. Boa sorte!</p>
            <p id="timer">05:00</p>
        </div>
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <div id="dialog" class="hidden">
            <p id="dialogMessage"></p>
            <button id="dialogButton">OK</button>
        </div>
    </div>
</body>
</html>

